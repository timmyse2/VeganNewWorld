
@{
    ViewData["Title"] = "訂單明細預覽";
    VNW.Models.Customer member = null;
    VNW.Models.Order newOrder = null;
    IEnumerable<VNW.Models.OrderDetail> OrderDetails = null;

}

<h2>@ViewData["Title"]</h2>

<div class="alert-danger">@TempData["td_serverWarning"]</div>
<div class="alert-info">@TempData["td_serverInfo"]</div>

<hr />
<h4>訂貨客戶</h4>
@if (ViewData["member"] != null)
{
    member = (VNW.Models.Customer)ViewData["member"];
    <ul>
        <li>ID: @member.CustomerId</li>
        <li>姓名: @member.ContactName</li>
        <li>公司: @member.CompanyName</li>
    </ul>
}
else
{
    <span>member is null</span>
}

<hr />



<h4>訂單主頁</h4>
@if (ViewData["newOrder"] != null)
{
    newOrder = (VNW.Models.Order)ViewData["newOrder"];

    <table class="table">
        <tr>
            <td>客戶帳號</td>
            <td>@newOrder.CustomerId</td>
        </tr>
        <tr>
            <td>訂單編號</td>
            <td><span class="text-warning">(會自動產生)</span>@*@newOrder.OrderId*@</td>
        </tr>
        <tr>
            <td>地址</td>
            <td>@newOrder.ShipAddress</td>
        </tr>
        <tr>
            <td>收貨地(公司|組織)</td>
            <td>@newOrder.ShipName</td>
        </tr>
        <tr>
            <td>城市</td>
            <td>@newOrder.ShipCity</td>
        </tr>
        <tr>
            <td>郵遞區號</td>
            <td>@newOrder.ShipPostalCode</td>
        </tr>
        <tr>
            <td>訂貨時間</td>
            <td>@newOrder.OrderDate <span class="text-warning">(預計, 會自動產生)</span> </td>
        </tr>
        @*<tr>
            <td>需求時間</td>
            <td>@newOrder.RequiredDate (TBC)</td>
        </tr>*@
        <tr>
            @*<td>@Html.DisplayName(newOrder.ShippedDate)</td>*@
            <td>寄送時間</td>            
            <td> <span class="text-warning">(待店家接單會自動產生)</span> @*@item.OrderId*@</td>
        </tr>
        <tr>
            <td>送貨方式</td>
            <td>@newOrder.ShipVia</td>
        </tr>
        <tr>
            <td>運費</td>
            <td>@newOrder.Freight</td>
        </tr>
    </table>

}

<hr />
<h4>訂單明細</h4>
@if (ViewData["OrderDetails"] != null)
{
    OrderDetails = (IEnumerable<VNW.Models.OrderDetail>)ViewData["OrderDetails"];
    <table class="table">
        <tr>
            <td>#</td>
            <td>訂單編號</td>
            <td>商品編號</td>
            <td>商品名稱</td>
            <td>數量</td>
            <td>單價</td>
            <td>折扣</td>
            <td>小記</td>
        </tr>
        @{
            decimal totalSum = 0;
            int i = 0;
        }

        @foreach (var item in OrderDetails)
        {
            <tr>
                <td>@(++i)</td>
                <td> <span class="text-warning">(會自動產生)</span> @*@item.OrderId*@</td>
                <td>@item.ProductId</td>
                <td>
                    @if (item.Product != null)
                    {
                        @item.Product.ProductName
                    }
                </td>
                <td>@item.Quantity </td>
                <td>$@item.UnitPrice</td>
                <td>@item.Discount </td>
                @{
                    decimal totalPrice = item.UnitPrice * item.Quantity;
                    totalSum += totalPrice;
                }

                <td>$@(totalPrice) </td>

                @*<td>@item.Product.UnitsInStock </td>
                    <td>@item.Product.UnitsOnOrder </td>*@
            </tr>
        }
    </table>
    <h3 style="text-align:right">總計: NT$@totalSum</h3>
}


    <div style="text-align:right;">
        <a class="btn btn-lg btn-danger" asp-action="PrepareOrder" style="margin-right:20px;">退回前一步</a>
        <a class="btn btn-lg btn-primary" asp-controller="Orders" asp-action="CreateOrderAndDetails">確認並送出</a>
        <p>註: 按下[確認並送出]才正式產生訂單資料</p>
    </div>





<table class="table-bordered">
    <tr>
        <td></td>
        <td></td>
        <td></td>
    </tr>

</table>








