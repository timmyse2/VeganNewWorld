@*@model VNW.ViewModels.ProductsViewModel*@

@model VNW.Models.Product

@{
    //ViewData["Title"] = "Product_Details";
    ViewData["Title"] = Model.ProductName;
}

<p>
    <a asp-action="Index" asp-controller="Home">首頁</a>
    > <a asp-action="CategoryList" asp-controller="categories">商品分類</a>
    > <a asp-action="ProductList"> @ViewBag.catName</a>    
</p>
<h2>@Model.ProductName</h2>

<div>
    @*<h4>@Model.ProductName</h4>*@
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.ProductName)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.ProductName)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.UnitPrice)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.UnitPrice)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.QuantityPerUnit)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.QuantityPerUnit)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.CategoryId)
        </dt>
        <dd>
            @*@Html.DisplayFor(model => model.CategoryId)*@
            @Html.DisplayFor(model => model.Category.CategoryName)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.UnitsInStock)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.UnitsInStock)
        </dd>
        <dt>
            @*@Html.DisplayNameFor(model => model.Picture)*@
        </dt>
        <dd>
            @if (Model.Picture != null)
            {
                <img src="~/images/@Model.Picture"
                     style="width:250px;" />
                //border: solid; border - width:1px; border - radius:5px;
            }
        </dd>
        <dt>@Html.DisplayNameFor(model => model.Description)</dt>
        <dd>@Model.Description </dd>

        <dd>
            <div class="btn btn-lg btn-primary" id="btn_AddProductInOrder">加入購物車</div>
            <div class="alert-info" id="txt_Message"></div>
            <div class="alert-danger" id="txt_failMessage"></div>
        </dd>
    </dl>
</div>
@*<div>
    | <a asp-action="CategoryList" asp-controller="categories">商品分類</a>
    | <a asp-action="ProductList">回到商品清單</a>
    |
</div>*@
註: 產品資料會先暫存在您的瀏覽器Cookie中， 請登入後完成訂單


@section endJS{
    @*<!--jquery code-->*@
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>
        console.log("jquery start");

        var btn_AddProductInOrder = $('#btn_AddProductInOrder');
        //btn_AddProductInOrder.click(btn_AddProductInOrder_click);

        $('#btn_AddProductInOrder').click(btn_AddProductInOrder_click);
        
        function btn_AddProductInOrder_click() {
            console.log("btn_AddProductInOrder_click");
            //::call api (store p.id in cookie)
            //$('#btn_AddProductInOrder').hide();
            $("#txt_Message").text("處理中");
            //ajax
            try {
                console.log("ajax r/w data...");
                var surl = "../AddProductInOrder";
                $.ajax({
                    url: surl,
                    type: "POST",
                    dateType: "json",
                    data: {
                        pid: @Model.ProductId,
                        catid: @Model.CategoryId
                        //password: $("#password").val(),
                        //pin: $("#pin").val(),
                    },
                    success: function (data) {
                        console.log("get data")
                        console.log(data)

                        if (data.result == "PASS") {
                            //login pass

                            $("#txt_Message").text("已加入"); 
                            console.log("PASS ");  //data.detail           
                            //window.location.href = "../";
                        }
                        else {
                            //fail case
                            var failMessage = "※提示：找不到符合您輸入的資料!";
                            $("#txt_Message").text("");
                            $("#txt_failMessage").text(failMessage);
                            console.log("note pass");            
                        }
                        //$('#btn_AddProductInOrder').show();

                    }, //success
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log(xhr)                        
                        $("#txt_failMessage").text("發生未知錯誤");
                    }//error                    
                });
                return;
            }
            catch (err) {
                console.log("exception " + err);
                //btn_AddProductInOrder.show();
                $("#txt_failMessage").text("發生未知錯誤");
                return;
            }


        }

        //btn_AddProductInOrder.click(function () {
        //    console.log("btn click");
        //});

        
        


        console.log("jquery end");
    </script>

}